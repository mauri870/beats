$schema: http://json-schema.org/draft-07/schema
type: object
title: Metricbeat Configuration Schema
description: Schema for Metricbeat configuration files
properties:
  metricbeat.config.modules:
    type: object
    description: Configuration for Metricbeat modules
    properties:
      path:
        type: string
        description: Glob pattern for configuration loading
      reload.enabled:
        type: boolean
        description: Set to true to enable config reloading
      reload.period:
        type: string
        description: Period on which files under path should be checked for changes

  metricbeat.max_start_delay:
    type: string
    description: Upper bound on the random startup delay for metricbeat
    
  metricbeat.autodiscover:
    type: object
    description: Autodiscover allows you to detect changes in the system and spawn new modules as they happen
    properties:
      providers:
        type: array
        items:
          type: object
          properties:
            type:
              type: string
              description: Provider type (docker, kubernetes, etc.)
            templates:
              type: array
              items:
                type: object
                properties:
                  condition:
                    type: object
                    description: Condition to match
                  config:
                    type: array
                    description: Configuration for matched condition
  
  timeseries.enabled:
    type: boolean
    description: Enable or disable time series indexing mode

  metricbeat.modules:
    type: array
    description: Configuration for modules
    items:
      type: object
      properties:
        module:
          type: string
          description: Name of the module
        metricsets:
          type: array
          items:
            type: string
          description: List of metricsets to enable for the module
        enabled:
          type: boolean
          description: Enable/disable the module
          default: true
        period:
          type: string
          description: How often to collect metrics
          default: "10s"
        hosts:
          type: array
          items:
            type: string
          description: List of hosts to connect to
        timeout:
          type: string
          description: Connection timeout
        processes:
          type: array
          items:
            type: string
          description: Process patterns to monitor
        hostfs:
          type: string
          description: Mount point of the host's filesystem for containerized monitoring
        username:
          type: string
          description: Username for authentication
        password:
          type: string
          description: Password for authentication
        path:
          type: string
          description: HTTP path to use for requests
      required: ["module"]
      additionalProperties: true

  output.elasticsearch:
    type: object
    description: Elasticsearch output configuration
    properties:
      enabled:
        type: boolean
        description: Boolean flag to enable or disable the output module
        default: true
      hosts:
        type: array
        items:
          type: string
        description: Array of hosts to connect to
        default: ["localhost:9200"]
      preset:
        type: string
        enum: ["balanced", "throughput", "scale", "latency", "custom"]
        description: Performance presets configure other output fields to recommended values
        default: "custom"
      compression_level:
        type: integer
        minimum: 0
        maximum: 9
        description: Set gzip compression level. Set to 0 to disable compression
        default: 1
      escape_html:
        type: boolean
        description: Configure escaping HTML symbols in strings
        default: false
      protocol:
        type: string
        enum: ["http", "https"]
        description: Protocol - either http (default) or https
        default: "http"
      api_key:
        type: string
        description: API key for authentication (format id:api_key)
      username:
        type: string
        description: Username for authentication
      password:
        type: string
        description: Password for authentication
      parameters:
        type: object
        description: Dictionary of HTTP parameters to pass within the URL with index operations
        additionalProperties:
          type: string
      worker:
        type: integer
        minimum: 1
        description: Number of workers per Elasticsearch host
        default: 1
      loadbalance:
        type: boolean
        description: If set to true, load balances published events onto all Elasticsearch hosts
        default: true
      index:
        type: string
        description: Optional data stream or index name
        default: "metricbeat-%{[agent.version]}"
      pipeline:
        type: string
        description: Optional ingest pipeline
      path:
        type: string
        description: Optional HTTP path
      headers:
        type: object
        description: Custom HTTP headers to add to each request
        additionalProperties:
          type: string
      proxy_url:
        type: string
        description: Proxy server URL
      proxy_disable:
        type: boolean
        description: Whether to disable proxy settings for outgoing connections
        default: false
      max_retries:
        type: integer
        minimum: 0
        description: The number of times a particular Elasticsearch index operation is attempted
        default: 3
      bulk_max_size:
        type: integer
        minimum: 1
        description: The maximum number of events to bulk in a single Elasticsearch bulk API index request
        default: 1600
      backoff:
        type: object
        description: Backoff configuration for reconnection attempts
        properties:
          init:
            type: string
            description: The number of seconds to wait before trying to reconnect after a network error
            default: "1s"
          max:
            type: string
            description: The maximum number of seconds to wait before attempting to connect after a network error
            default: "60s"
        additionalProperties: false
      idle_connection_timeout:
        type: string
        description: The maximum amount of time an idle connection will remain idle before closing
        default: "3s"
      timeout:
        type: integer
        description: Configure HTTP request timeout before failing a request to Elasticsearch
        default: 90
      allow_older_versions:
        type: boolean
        description: Prevents metricbeat from connecting to older Elasticsearch versions when set to false
        default: true
      ssl:
        type: object
        description: SSL/TLS configuration for HTTPS connections
        properties:
          enabled:
            type: boolean
            description: Use SSL settings for HTTPS
            default: false
          verification_mode:
            type: string
            enum: ["full", "strict", "certificate", "none"]
            description: Controls the verification of certificates
            default: "full"
          supported_protocols:
            type: array
            items:
              type: string
              enum: ["TLSv1.0", "TLSv1.1", "TLSv1.2", "TLSv1.3"]
            description: List of supported/valid TLS versions
            default: ["TLSv1.1", "TLSv1.2", "TLSv1.3"]
          certificate_authorities:
            type: array
            items:
              type: string
            description: List of root certificates for HTTPS server verifications
          certificate:
            type: string
            description: Certificate for SSL client authentication
          key:
            type: string
            description: Client certificate key
          key_passphrase:
            type: string
            description: Optional passphrase for decrypting the certificate key
          cipher_suites:
            type: array
            items:
              type: string
            description: Configure cipher suites to be used for SSL connections
          curve_types:
            type: array
            items:
              type: string
            description: Configure curve types for ECDHE-based cipher suites
          renegotiation:
            type: string
            enum: ["never", "once", "freely"]
            description: Configure what types of renegotiation are supported
            default: "never"
          ca_sha256:
            type: string
            description: Configure a pin for extra validation of the verified certificate chain
          ca_trusted_fingerprint:
            type: string
            description: A root CA HEX encoded fingerprint
          restart_on_cert_change:
            type: object
            description: Configuration for restarting metricbeat on certificate changes
            properties:
              enabled:
                type: boolean
                description: Enables restarting metricbeat if any certificate file is modified
                default: false
              period:
                type: string
                description: Period to scan for changes on CA certificate files
                default: "1m"
            additionalProperties: false
        additionalProperties: false
      kerberos:
        type: object
        description: Kerberos authentication configuration
        properties:
          enabled:
            type: boolean
            description: Enable Kerberos support
            default: false
          auth_type:
            type: string
            enum: ["keytab", "password"]
            description: Authentication type to use with Kerberos
            default: "password"
          keytab:
            type: string
            description: Path to the keytab file
          config_path:
            type: string
            description: Path to the Kerberos configuration
          username:
            type: string
            description: Name of the Kerberos user
          password:
            type: string
            description: Password of the Kerberos user
          realm:
            type: string
            description: Kerberos realm
        additionalProperties: false
    additionalProperties: false
  output.logstash:
    type: object
    description: Logstash output configuration
    properties:
      enabled:
        type: boolean
        description: Boolean flag to enable or disable the output module
        default: true
      hosts:
        type: array
        items:
          type: string
        description: The Logstash hosts
        default: ["localhost:5044"]
      worker:
        type: integer
        minimum: 1
        description: Number of workers per Logstash host
        default: 1
      compression_level:
        type: integer
        minimum: 0
        maximum: 9
        description: Set gzip compression level
        default: 3
      escape_html:
        type: boolean
        description: Configure escaping HTML symbols in strings
        default: false
      ttl:
        type: string
        description: Optional maximum time to live for a connection to Logstash
        default: "0s"
      loadbalance:
        type: boolean
        description: Optionally load-balance events between Logstash hosts
        default: false
      pipelining:
        type: integer
        minimum: 0
        description: Number of batches to be sent asynchronously to Logstash while processing new batches
        default: 2
      slow_start:
        type: boolean
        description: If enabled only a subset of events in a batch of events is transferred per transaction
        default: false
      backoff:
        type: object
        description: Backoff configuration for reconnection attempts
        properties:
          init:
            type: string
            description: The number of seconds to wait before trying to reconnect after a network error
            default: "1s"
          max:
            type: string
            description: The maximum number of seconds to wait before attempting to connect after a network error
            default: "60s"
        additionalProperties: false
      index:
        type: string
        description: Optional index name
        default: "metricbeat"
      proxy_url:
        type: string
        description: SOCKS5 proxy server URL
      proxy_use_local_resolver:
        type: boolean
        description: Resolve names locally when using a proxy server
        default: false
      ssl:
        type: object
        description: SSL/TLS configuration for HTTPS connections
        properties:
          enabled:
            type: boolean
            description: Use SSL settings for HTTPS
            default: false
          verification_mode:
            type: string
            enum: ["full", "strict", "certificate", "none"]
            description: Controls the verification of certificates
            default: "full"
          supported_protocols:
            type: array
            items:
              type: string
              enum: ["TLSv1.0", "TLSv1.1", "TLSv1.2", "TLSv1.3"]
            description: List of supported/valid TLS versions
            default: ["TLSv1.1", "TLSv1.2", "TLSv1.3"]
          certificate_authorities:
            type: array
            items:
              type: string
            description: List of root certificates for HTTPS server verifications
          certificate:
            type: string
            description: Certificate for SSL client authentication
          key:
            type: string
            description: Client certificate key
          key_passphrase:
            type: string
            description: Optional passphrase for decrypting the certificate key
          cipher_suites:
            type: array
            items:
              type: string
            description: Configure cipher suites to be used for SSL connections
          curve_types:
            type: array
            items:
              type: string
            description: Configure curve types for ECDHE-based cipher suites
          renegotiation:
            type: string
            enum: ["never", "once", "freely"]
            description: Configure what types of renegotiation are supported
            default: "never"
          ca_sha256:
            type: string
            description: Configure a pin for extra validation of the verified certificate chain
        additionalProperties: false
    additionalProperties: false
  output.file:
    type: object
    description: File output configuration
    properties:
      enabled:
        type: boolean
        description: Boolean flag to enable or disable the output module
        default: true
      codec.json:
        type: object
        description: Configure JSON encoding
        properties:
          pretty:
            type: boolean
            description: Pretty-print JSON event
            default: false
          escape_html:
            type: boolean
            description: Configure escaping HTML symbols in strings
            default: false
        additionalProperties: false
      path:
        type: string
        description: Path to the directory where to save the generated files
        default: "/tmp/metricbeat"
      filename:
        type: string
        description: Name of the generated files
        default: "metricbeat"
      rotate_every_kb:
        type: integer
        minimum: 1
        description: Maximum size in kilobytes of each file
        default: 10240
      number_of_files:
        type: integer
        minimum: 1
        description: Maximum number of files under path
        default: 7
      permissions:
        type: string
        description: Permissions to use for file creation
        default: "0600"
      rotate_on_startup:
        type: boolean
        description: Configure automatic file rotation on every startup
        default: true
    required: ["path"]
    additionalProperties: false
  output.console:
    type: object
    description: Console output configuration
    properties:
      enabled:
        type: boolean
        description: Boolean flag to enable or disable the output module
        default: true
      pretty:
        type: boolean
        description: Pretty-print events in the console output
        default: false
      codec.json:
        type: object
        description: Configure JSON encoding
        properties:
          pretty:
            type: boolean
            description: Pretty-print JSON event
            default: false
          escape_html:
            type: boolean
            description: Configure escaping HTML symbols in strings
            default: false
        additionalProperties: false
    additionalProperties: false

  # ================= Kafka Output =================
  output.kafka:
    type: object
    description: Configuration for Kafka output
    properties:
      enabled:
        type: boolean
        description: Enable Kafka output
        default: false
      hosts:
        type: array
        items:
          type: string
        description: List of Kafka broker addresses
      topic:
        type: string
        description: Kafka topic name
      key:
        type: string
        description: Kafka event key
      username:
        type: string
        description: SASL username
      password:
        type: string
        description: SASL password
      version:
        type: string
        description: Kafka version
      compression:
        type: string
        description: Compression codec
        enum: ["none", "snappy", "gzip"]
        default: "gzip"
      max_retries:
        type: integer
        description: Number of retries after publishing failure
        default: 3
      bulk_max_size:
        type: integer
        description: Maximum number of events to bulk
        default: 2048
      timeout:
        type: string
        description: Response timeout
        default: "30s"
    additionalProperties: false

  # ================= Redis Output =================
  output.redis:
    type: object
    description: Configuration for Redis output
    properties:
      enabled:
        type: boolean
        description: Enable Redis output
        default: false
      hosts:
        type: array
        items:
          type: string
        description: List of Redis servers
      key:
        type: string
        description: Redis list or channel name
        default: "metricbeat"
      password:
        type: string
        description: Password for Redis authentication
      db:
        type: integer
        description: Redis database number
        default: 0
      datatype:
        type: string
        description: Redis data type
        enum: ["list", "channel"]
        default: "list"
      worker:
        type: integer
        description: Number of workers per host
        default: 1
      loadbalance:
        type: boolean
        description: Load balance events onto all Redis hosts
        default: true
      timeout:
        type: string
        description: Connection timeout
        default: "5s"
      max_retries:
        type: integer
        description: Number of retries after publishing failure
        default: 3
      bulk_max_size:
        type: integer
        description: Maximum number of events to bulk
        default: 2048
    additionalProperties: false

  # ================= Setup Configuration =================
  setup.template.settings:
    oneOf:
      - type: "null"
      - type: object
        description: Elasticsearch template settings
        properties:
          index.number_of_shards:
            type: integer
            description: Number of primary shards
            default: 1
          index.codec:
            type: string
            enum: ["default", "best_compression"]
            description: Compression codec for stored data
            default: "default"
          _source.enabled:
            type: boolean
            description: Whether to store the _source field
            default: true
        additionalProperties: true

  setup.dashboards.enabled:
    type: boolean
    description: Enable/disable loading sample dashboards
    default: false

  setup.dashboards.url:
    type: string
    description: URL from where to download the dashboard archive

  setup.dashboards.directory:
    type: string
    description: Directory to read dashboards from

  setup.dashboards.file:
    type: string
    description: Archive file to read dashboards from

  setup.dashboards.beat:
    type: string
    description: Beat name to load dashboards for

  setup.dashboards.kibana_index:
    type: string
    description: Kibana index name
    default: ".kibana"

  setup.dashboards.index:
    type: string
    description: Elasticsearch index name for dashboards

  setup.dashboards.always_kibana:
    type: boolean
    description: Always use Kibana API for loading dashboards
    default: false

  setup.dashboards.retry.enabled:
    type: boolean
    description: Enable retry for dashboard loading
    default: false

  setup.dashboards.retry.interval:
    type: string
    description: Interval between retries
    default: "1s"

  setup.dashboards.retry.maximum:
    type: integer
    description: Maximum number of retries
    default: 0

  setup.template.enabled:
    type: boolean
    description: Enable template loading
    default: true

  setup.template.name:
    type: string
    description: Template name

  setup.template.pattern:
    type: string
    description: Template pattern

  setup.template.fields:
    type: string
    description: Path to fields.yml file

  setup.template.append_fields:
    type: array
    description: Additional fields to append to template
    items:
      type: object

  setup.template.json.enabled:
    type: boolean
    description: Enable JSON template loading
    default: false

  setup.template.json.path:
    type: string
    description: Path to JSON template file

  setup.template.json.name:
    type: string
    description: Name for JSON template

  setup.template.json.data_stream:
    type: boolean
    description: Set if JSON template is a data stream
    default: false

  setup.template.overwrite:
    type: boolean
    description: Overwrite existing template
    default: false

  setup.ilm.enabled:
    type: boolean
    description: Enable Index Lifecycle Management
    default: true

  setup.ilm.policy_name:
    type: string
    description: Lifecycle policy name

  setup.ilm.policy_file:
    type: string
    description: Path to lifecycle policy file

  setup.ilm.check_exists:
    type: boolean
    description: Check for existing lifecycle policy
    default: true

  setup.ilm.overwrite:
    type: boolean
    description: Overwrite lifecycle policy at startup
    default: false

  setup.dsl.enabled:
    type: boolean
    description: Enable Data Stream Lifecycle
    default: true

  setup.dsl.data_stream_pattern:
    type: string
    description: Data stream pattern for DSL

  setup.dsl.policy_file:
    type: string
    description: Path to DSL policy file

  setup.dsl.check_exists:
    type: boolean
    description: Check for existing DSL policy
    default: true

  setup.dsl.overwrite:
    type: boolean
    description: Overwrite DSL policy at startup
    default: false

  setup.kibana:
    oneOf:
      - type: "null"
      - type: object
        description: Kibana endpoint configuration
        properties:
          host:
            type: string
            description: Kibana host URL
            default: "localhost:5601"
          space.id:
            type: string
            description: Kibana Space ID for dashboard loading
        additionalProperties: true

  # ================= Cloud Configuration =================
  cloud.id:
    type: string
    description: Elastic Cloud ID that overwrites output.elasticsearch.hosts and setup.kibana.host

  cloud.auth:
    type: string
    description: Cloud authentication in format <user>:<pass>

  # ================= Path Configuration =================
  path.home:
    type: string
    description: Home path for the Beat installation

  path.config:
    type: string
    description: Configuration path for the Beat installation

  path.data:
    type: string
    description: Data path for the Beat installation

  path.logs:
    type: string
    description: Logs path for the Beat installation

  # ================= Keystore Configuration =================
  keystore.path:
    type: string
    description: Location of the keystore containing keys and sensitive values

  # ================= General Settings =================
  name:
    type: string
    description: Name of the shipper that publishes the network data

  tags:
    type: array
    items:
      type: string
    description: Tags of the shipper included with each transaction

  fields:
    type: object
    description: Optional fields to add additional information to the output
    additionalProperties: true

  fields_under_root:
    type: boolean
    description: Store custom fields as top-level fields
    default: false

  timestamp.precision:
    type: string
    description: Configure the precision of all timestamps
    enum: ["millisecond", "microsecond", "nanosecond"]
    default: "millisecond"

  queue:
    type: object
    description: Internal queue configuration for buffering events
    properties:
      mem:
        type: object
        properties:
          events:
            type: integer
            description: Max number of events the queue can buffer
          flush.min_events:
            type: integer
            description: Minimum number of events required for publishing
          flush.timeout:
            type: string
            description: Maximum wait time for flush.min_events to be fulfilled
      disk:
        type: object
        properties:
          path:
            type: string
            description: Directory path to store the queue's data
          max_size:
            type: string
            description: Maximum size of the queue on disk
          segment_size:
            type: string
            description: Size for each segment file in the queue
          read_ahead:
            type: integer
            description: Number of events to read ahead for batching
          write_ahead:
            type: integer
            description: Number of events to buffer for batching write operations
          retry_interval:
            type: string
            description: Retry interval for read/write operations
          max_retry_interval:
            type: string
            description: Maximum retry interval

  max_procs:
    type: integer
    description: Maximum number of CPUs that can be executed simultaneously

  # ================= Processors =================
  processors:
    type: array
    description: List of processors to enhance or manipulate events
    items:
      type: object
      properties:
        add_host_metadata:
          oneOf:
            - type: "null"
            - type: object
              additionalProperties: true
        add_cloud_metadata:
          oneOf:
            - type: "null"
            - type: object
              additionalProperties: true
        add_docker_metadata:
          oneOf:
            - type: "null"
            - type: object
              additionalProperties: true
        add_kubernetes_metadata:
          oneOf:
            - type: "null"
            - type: object
              additionalProperties: true
      additionalProperties: true

  # ================= Logging Configuration =================
  logging.level:
    type: string
    enum: ["error", "warning", "info", "debug"]
    description: Log level setting
    default: "info"

  logging.selectors:
    type: array
    items:
      type: string
    description: Selectors for debug level logging

  logging.to_stderr:
    type: boolean
    description: Send all logging output to stderr
    default: false

  logging.to_syslog:
    type: boolean
    description: Send all logging output to syslog
    default: false

  logging.to_eventlog:
    type: boolean
    description: Send all logging output to Windows Event Logs
    default: false

  logging.to_files:
    type: boolean
    description: Enable logging to files
    default: true

  logging.files:
    oneOf:
      - type: "null"
      - type: object
        description: File logging configuration
        properties:
          path:
            type: string
            description: Path where log files are written
          name:
            type: string
            description: Name of log files
          rotateeverybytes:
            type: integer
            description: Log file size limit for rotation
            default: 10485760
          keepfiles:
            type: integer
            description: Number of rotated log files to keep
            default: 7
          permissions:
            type: integer
            description: Permissions mask for log files
            default: 384
          interval:
            type: string
            description: Time interval for log rotation
          rotateonstartup:
            type: boolean
            description: Rotate log file on startup
            default: true
        additionalProperties: false

  logging.metrics.enabled:
    type: boolean
    description: Enable periodic logging of internal metrics
    default: true

  logging.metrics.period:
    type: string
    description: Period for logging internal metrics
    default: "30s"

  logging.metrics.namespaces:
    type: array
    items:
      type: string
    description: Metrics namespaces to report in logs
    default: ["stats"]

  # ================= Monitoring Configuration =================
  monitoring.enabled:
    type: boolean
    description: Enable the monitoring reporter
    default: false

  monitoring.cluster_uuid:
    type: string
    description: UUID of the Elasticsearch cluster for monitoring data

  monitoring.elasticsearch:
    type: object
    description: Elasticsearch monitoring configuration
    additionalProperties: true

  # ================= Instrumentation Configuration =================
  instrumentation:
    type: object
    description: Instrumentation support configuration
    properties:
      enabled:
        type: boolean
        description: Enable instrumentation of metricbeat
        default: false
      environment:
        type: string
        description: Environment in which metricbeat is running
      hosts:
        type: array
        items:
          type: string
        description: APM Server hosts to report instrumentation results to
      api_key:
        type: string
        description: API Key for the APM Server(s)
      secret_token:
        type: string
        description: Secret token for the APM Server(s)
    additionalProperties: false

  # ================= HTTP Endpoint Configuration =================
  http.enabled:
    type: boolean
    description: Enable HTTP endpoint for stats and info
    default: false

  http.host:
    type: string
    description: Host for HTTP endpoint
    default: "localhost"

  http.port:
    type: integer
    description: Port for HTTP endpoint
    default: 5066

  http.named_pipe.user:
    type: string
    description: User for named pipe on Windows

  http.named_pipe.security_descriptor:
    type: string
    description: Security descriptor for named pipe on Windows

  http.pprof.enabled:
    type: boolean
    description: Enable pprof endpoints
    default: false

  http.pprof.block_profile_rate:
    type: integer
    description: Sampling rate for block profiling
    default: 0

  http.pprof.mem_profile_rate:
    type: integer
    description: Sampling rate for memory profiling
    default: 524288

  http.pprof.mutex_profile_rate:
    type: integer
    description: Sampling rate for mutex profiling
    default: 0

  # ================= Migration Configuration =================
  migration.6_to_7.enabled:
    type: boolean
    description: Enable 6.7 migration aliases
    default: false

additionalProperties: true